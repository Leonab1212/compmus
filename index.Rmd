---
title: "Computational Musicology"
author: "Leon Bartelsman"
date: "2019"
output: 
    flexdashboard::flex_dashboard:
        storyboard: true
        theme: lumen
---

`r knitr::opts_chunk$set(cache = TRUE)`

```{r, cache = FALSE}
# In order to use these packages, we need to install flexdashboard, plotly, and Cairo.
library(tidyverse)
library(plotly)
library(spotifyr)
source('spotify.R')
```

### Indtroduction

```{r}
get_tidy_audio_analysis('5S94PIQplSfBHZXsZowyGY')
get_tidy_audio_analysis('spotify:track:5QN27OeUkJuQX09TEvn48H')
```
![](images/CP.png) ![](images/HHTM.png)

TODO:

ADD:


music clip of both hhtm and orni


***

I will be analysing to the jazz standard Ornithology, first recorded by Charlie Parker. Ornithology is a refference to Parkers nickname "Bird". Jazz standards often differ from one another quite alot, yet Ornithology is one among them that is particularly well known for all the different recordings. One reason for this is that the jazz standard has also been recorded under another name "How high the Moon", which follows the exact same chord progression as Ornithology, but is usually in a slower tempo. 

I want to know if there are any real measurable differences in recordings under the name How High the moon and Ornithology. What makes some musicians name the recording how they do. Are there actually some aspects that differ causing the different name, or is this an arbitrary prefference of the musicians, and are the names really interchangable. In order to get Find out if there are any differences I created a playlist containing ±100 How High The Moon recordings, and ±100 Ornithology recordings. 



### Visualisation of Tempo in 'Ornithology' and 'How High the moon;



```{r}
ornithology <- get_playlist_audio_features("1115668083", "3pMfdAOvErb9AEnAO9W2fa")
ggplot(ornithology, aes(x=tempo, fill=track_name)) + geom_histogram(position='dodge', binwidth = 15)

```



***

One of the first distiguishable features might be the tempo. As I stated earlier I believed that How high the Moon (HHTM) recordings usually were recorded in a slower tempo than Ornithology (OTHGY) recordings. However, this is not backed up by my findings.

On the left you will see a histogram the temp of all the recordings I added to my playlist. As You can see there are acctually no real differences in tempo between the recordings. Most recodings seem to cluster around 120 bpm. Yet my statement might not be completely untrue, as there are, just marginally, more slow HHTM recordings.

### Popularity vs Tempo.


```{r}
ggplot(ornithology, aes(x=tempo, y=track_popularity, color=track_name)) + geom_line(alpha=0.3) + geom_smooth(span=0.4)
```


***

It might be that the dataset I created, happened to only include unusually fast HHTM recordings. To check if this is the case, then the popularity of the faster HHTM tracks must be less then the popularity of the slower recordings of HHTM. Here we see the popularity versus the tempo for both titles. 

This graph shows us that my dataset does not consist of outlier recordings of HHTM, as the popularity of all different tempos of HHTM recordings relates well to the same tempo OTHGY recordings. Further more this graph tells us that there is a definite sweet spot in tempo, where the recordings are more popular. This occurs for both How High The Moon and Ornithology around 115BPM. At a slower tempo of 80BPM another spike in popularity is seen, telling us that this song, in both titles, is also enjoyed at a slower tempo. What is interesting to see is that eve though the original recording was titled Ornithology, the How high the Moon recordings seem to be more popular overal. Another thing we can easily see from this graph is that the three extremely fast recordings of how High The Moon are definately outliers in my dataset.


### similarity matrix and relation between hhtm and ornithology..

```{r}





otemp <- '6A1mh31895sUIYEpOfeqC3'
htemp <- '5ldNRCiBHlFlBlvJmDMlCn'
orni_maxPop <- 
    get_tidy_audio_analysis('5S94PIQplSfBHZXsZowyGY') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, pitches)
hhtm_maxPop <- 
    get_tidy_audio_analysis('5QN27OeUkJuQX09TEvn48H') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, pitches)

song_dist <- 
    compmus_long_distance(
    orni_maxPop %>% mutate(pitches = map(pitches, compmus_normalise, 'manhattan')),
    hhtm_maxPop %>% mutate(pitches = map(pitches, compmus_normalise, 'manhattan')),
    feature = pitches,
    method = 'aitchison')
```

```{r}
maria <- 
    song_dist %>% 
    mutate(
        orni_maxPop = xstart + xduration / 2, 
        hhtm_maxPop = ystart + yduration / 2) %>% 
    ggplot(
        aes(
            x = orni_maxPop,
            y = hhtm_maxPop,
            fill = d)) + 
    geom_tile(aes(width = xduration, height = yduration)) +
    coord_fixed() +
    scale_x_continuous(


        ) +
    scale_y_continuous(

  
        ) +
    scale_fill_viridis_c(option = 'E', guide = "none") +
    theme_classic() + 
    theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
    labs(x = 'Ornithologys', y = 'How high the moon')
# ggsave('maria.png', maria, width = 13, height = 8, dpi = 'retina')
maria
```

***

As you can see these recordings dont seem to be very similar pitch wise according to this similarity matrix...

I have to think about why this is. I also still want to create a couple of other matrices. This one is for maximum popularity orni vs hhtm. I also want to make the same matrix but then with the least popular two titles. That way i can aybe see what structure wise makes them popular (or not). Also, I want to create the same matrices for timbre. 
Last but not leat I also want to redo all the above, but with self similarity matrices.


